<?xml version="1.0" encoding="utf-8"?>
<ServiceDefinition name="NuGetGallery.Cloud" xmlns="http://schemas.microsoft.com/ServiceHosting/2008/10/ServiceDefinition" schemaVersion="2013-03.2.0">
    <LoadBalancerProbes>
        <LoadBalancerProbe name="HTTP" path="/api/v2/Packages" protocol="http" />
        <LoadBalancerProbe name="HTTPS" path="/api/v2/Packages" protocol="http" port="443" />
    </LoadBalancerProbes>
    <WebRole name="NuGetGallery" vmsize="Medium">
        <Sites>
            <Site name="Web">
                <Bindings>
                    <Binding name="HttpBinding" endpointName="HttpEndpoint" />
                    <Binding name="HttpsBinding" endpointName="HttpsEndpoint" />
                </Bindings>
            </Site>
        </Sites>
        <Endpoints>
            <InputEndpoint name="HttpEndpoint" protocol="http" port="80" loadBalancerProbe="HTTP" />
            <InputEndpoint name="HttpsEndpoint" protocol="https" port="443" loadBalancerProbe="HTTPS" certificate="SSLCertificate" />
            <InstanceInputEndpoint name="HttpInstanceEndpoint" protocol="tcp" localPort="80">
                <AllocatePublicPortFrom>
                    <FixedPortRange max="8089" min="8081" />
                </AllocatePublicPortFrom>
            </InstanceInputEndpoint>
            <InstanceInputEndpoint name="HttpsInstanceEndpoint" protocol="tcp" localPort="443">
                <AllocatePublicPortFrom>
                    <FixedPortRange max="44309" min="44301" />
                </AllocatePublicPortFrom>
            </InstanceInputEndpoint>
        </Endpoints>
        <Imports>
            <Import moduleName="Diagnostics" />
            <Import moduleName="RemoteAccess" />
            <Import moduleName="RemoteForwarder" />
        </Imports>
        <Certificates>
            <Certificate name="SSLCertificate" storeLocation="LocalMachine" storeName="My" />
        </Certificates>
    </WebRole>
</ServiceDefinition>